<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelGram - Share Your Adventures</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        #map {
            height: 400px;
            width: 100%;
            border-radius: 1rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';

        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [view, setView] = useState('home');
            const [viewData, setViewData] = useState(null);
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadUsers();
            }, []);

            async function loadUsers() {
                try {
                    const result = await window.storage.get('travelgram_users', true);
                    if (result && result.value) {
                        setUsers(JSON.parse(result.value));
                    }
                } catch (error) {
                    console.log('No existing users');
                }
                setLoading(false);
            }

            async function saveUsers(updatedUsers) {
                try {
                    await window.storage.set('travelgram_users', JSON.stringify(updatedUsers), true);
                    setUsers(updatedUsers);
                } catch (error) {
                    console.error('Save error:', error);
                }
            }

            async function createAccount(username, name) {
                const newUser = {
                    id: Date.now().toString(),
                    username,
                    name,
                    bio: '',
                    cities: []
                };
                const updatedUsers = [...users, newUser];
                await saveUsers(updatedUsers);
                setCurrentUser(newUser);
                setView('profile');
                setViewData(newUser);
            }

            async function login(username) {
                const user = users.find(u => u.username === username);
                if (user) {
                    setCurrentUser(user);
                    setView('profile');
                    setViewData(user);
                    return true;
                }
                return false;
            }

            async function addCity(cityName, country) {
                const newCity = {
                    id: Date.now().toString(),
                    name: cityName,
                    country,
                    places: []
                };
                const updatedUser = { ...currentUser };
                updatedUser.cities.push(newCity);
                
                const updatedUsers = users.map(u => u.id === updatedUser.id ? updatedUser : u);
                await saveUsers(updatedUsers);
                setCurrentUser(updatedUser);
                setViewData(updatedUser);
            }

            async function addPlace(cityId, place) {
                const updatedUser = { ...currentUser };
                const city = updatedUser.cities.find(c => c.id === cityId);
                
                const newPlace = {
                    ...place,
                    id: Date.now().toString()
                };
                
                city.places.push(newPlace);
                
                const updatedUsers = users.map(u => u.id === updatedUser.id ? updatedUser : u);
                await saveUsers(updatedUsers);
                setCurrentUser(updatedUser);
            }

            function logout() {
                setCurrentUser(null);
                setView('home');
                setViewData(null);
            }

            if (loading) {
                return React.createElement('div', {
                    className: 'min-h-screen flex items-center justify-center gradient-bg'
                }, 
                    React.createElement('div', {
                        className: 'text-white text-2xl font-light'
                    }, 'Loading...')
                );
            }

            return React.createElement('div', { className: 'min-h-screen bg-gray-50' },
                currentUser && React.createElement(Header, {
                    currentUser,
                    onLogout: logout,
                    onNavigate: (v, d) => { setView(v); setViewData(d); }
                }),
                React.createElement('main', { 
                    className: currentUser ? 'pt-16' : ''
                },
                    view === 'home' && !currentUser && React.createElement(LoginSignup, {
                        onLogin: login,
                        onCreate: createAccount,
                        users
                    }),
                    view === 'profile' && viewData && React.createElement(ProfileView, {
                        user: viewData,
                        isOwnProfile: currentUser?.id === viewData.id,
                        onCityClick: (city) => { setView('city'); setViewData({ user: viewData, city }); },
                        onAddCity: currentUser?.id === viewData.id ? addCity : null
                    }),
                    view === 'city' && viewData && React.createElement(CityView, {
                        user: viewData.user,
                        city: viewData.city,
                        isOwnCity: currentUser?.id === viewData.user.id,
                        onAddPlace: currentUser?.id === viewData.user.id ? addPlace : null,
                        onBack: () => { setView('profile'); setViewData(viewData.user); }
                    }),
                    view === 'explore' && React.createElement(ExploreView, {
                        users,
                        currentUser,
                        onProfileClick: (user) => { setView('profile'); setViewData(user); }
                    })
                )
            );
        };

        const Header = ({ currentUser, onLogout, onNavigate }) => {
            return React.createElement('header', {
                className: 'fixed top-0 left-0 right-0 bg-white border-b border-gray-200 z-50'
            },
                React.createElement('div', {
                    className: 'max-w-5xl mx-auto px-4 py-3 flex justify-between items-center'
                },
                    React.createElement('h1', {
                        className: 'text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent cursor-pointer',
                        onClick: () => onNavigate('profile', currentUser)
                    }, 'TravelGram'),
                    React.createElement('nav', {
                        className: 'flex items-center gap-8'
                    },
                        React.createElement('button', {
                            onClick: () => onNavigate('profile', currentUser),
                            className: 'text-gray-700 hover:text-gray-900 font-medium'
                        }, 
                            React.createElement('svg', {
                                className: 'w-6 h-6',
                                fill: 'none',
                                stroke: 'currentColor',
                                viewBox: '0 0 24 24'
                            },
                                React.createElement('path', {
                                    strokeLinecap: 'round',
                                    strokeLinejoin: 'round',
                                    strokeWidth: 2,
                                    d: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'
                                })
                            )
                        ),
                        React.createElement('button', {
                            onClick: () => onNavigate('explore', null),
                            className: 'text-gray-700 hover:text-gray-900 font-medium'
                        }, 
                            React.createElement('svg', {
                                className: 'w-6 h-6',
                                fill: 'none',
                                stroke: 'currentColor',
                                viewBox: '0 0 24 24'
                            },
                                React.createElement('path', {
                                    strokeLinecap: 'round',
                                    strokeLinejoin: 'round',
                                    strokeWidth: 2,
                                    d: 'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'
                                })
                            )
                        ),
                        React.createElement('button', {
                            onClick: onLogout,
                            className: 'text-gray-600 hover:text-gray-900 text-sm font-medium'
                        }, 'Logout')
                    )
                )
            );
        };

        const LoginSignup = ({ onLogin, onCreate, users }) => {
            const [mode, setMode] = useState('signup');
            const [username, setUsername] = useState('');
            const [name, setName] = useState('');
            const [error, setError] = useState('');

            async function handleSubmit(e) {
                e.preventDefault();
                setError('');
                
                if (mode === 'login') {
                    const success = await onLogin(username);
                    if (!success) {
                        setError('Username not found');
                    }
                } else {
                    if (!username.trim() || !name.trim()) {
                        setError('Please fill in all fields');
                        return;
                    }
                    if (users.find(u => u.username === username)) {
                        setError('Username already exists');
                        return;
                    }
                    await onCreate(username, name);
                }
            }

            return React.createElement('div', {
                className: 'min-h-screen gradient-bg flex items-center justify-center p-4'
            },
                React.createElement('div', {
                    className: 'w-full max-w-md'
                },
                    React.createElement('div', {
                        className: 'text-center mb-8'
                    },
                        React.createElement('h1', {
                            className: 'text-5xl font-bold text-white mb-3'
                        }, 'TravelGram'),
                        React.createElement('p', {
                            className: 'text-white text-opacity-90 text-lg'
                        }, 'Share your travel adventures with the world')
                    ),
                    React.createElement('div', {
                        className: 'bg-white rounded-2xl shadow-2xl p-8'
                    },
                        React.createElement('div', {
                            className: 'flex gap-2 mb-6'
                        },
                            React.createElement('button', {
                                onClick: () => { setMode('signup'); setError(''); setUsername(''); setName(''); },
                                className: mode === 'signup' 
                                    ? 'flex-1 py-3 rounded-xl font-semibold bg-gradient-to-r from-purple-600 to-pink-600 text-white'
                                    : 'flex-1 py-3 rounded-xl font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200'
                            }, 'Sign Up'),
                            React.createElement('button', {
                                onClick: () => { setMode('login'); setError(''); setUsername(''); setName(''); },
                                className: mode === 'login'
                                    ? 'flex-1 py-3 rounded-xl font-semibold bg-gradient-to-r from-purple-600 to-pink-600 text-white'
                                    : 'flex-1 py-3 rounded-xl font-semibold bg-gray-100 text-gray-600 hover:bg-gray-200'
                            }, 'Login')
                        ),
                        React.createElement('form', {
                            onSubmit: handleSubmit,
                            className: 'space-y-4'
                        },
                            mode === 'signup' && React.createElement('div', {},
                                React.createElement('label', {
                                    className: 'block text-sm font-medium text-gray-700 mb-2'
                                }, 'Full Name'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: name,
                                    onChange: (e) => setName(e.target.value),
                                    className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition',
                                    placeholder: 'Jane Doe'
                                })
                            ),
                            React.createElement('div', {},
                                React.createElement('label', {
                                    className: 'block text-sm font-medium text-gray-700 mb-2'
                                }, 'Username'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: username,
                                    onChange: (e) => setUsername(e.target.value),
                                    className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition',
                                    placeholder: 'janedoe'
                                })
                            ),
                            error && React.createElement('div', {
                                className: 'bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-xl text-sm'
                            }, error),
                            React.createElement('button', {
                                type: 'submit',
                                className: 'w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-xl font-semibold hover:opacity-90 transition shadow-lg'
                            }, mode === 'login' ? 'Login' : 'Create Account')
                        )
                    )
                )
            );
        };

        const ProfileView = ({ user, isOwnProfile, onCityClick, onAddCity }) => {
            const [showAddCity, setShowAddCity] = useState(false);
            const [cityName, setCityName] = useState('');
            const [country, setCountry] = useState('');

            async function handleAddCity(e) {
                e.preventDefault();
                if (cityName.trim() && country.trim()) {
                    await onAddCity(cityName, country);
                    setCityName('');
                    setCountry('');
                    setShowAddCity(false);
                }
            }

            const totalPlaces = user.cities.reduce((sum, city) => sum + city.places.length, 0);

            return React.createElement('div', {
                className: 'max-w-5xl mx-auto px-4 py-8'
            },
                React.createElement('div', {
                    className: 'bg-white rounded-2xl shadow-sm p-8 mb-8'
                },
                    React.createElement('div', {
                        className: 'flex items-start gap-8'
                    },
                        React.createElement('div', {
                            className: 'w-32 h-32 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-4xl font-bold flex-shrink-0'
                        }, user.name.charAt(0).toUpperCase()),
                        React.createElement('div', {
                            className: 'flex-1'
                        },
                            React.createElement('div', {
                                className: 'flex items-center justify-between mb-4'
                            },
                                React.createElement('div', {},
                                    React.createElement('h2', {
                                        className: 'text-3xl font-bold text-gray-900 mb-1'
                                    }, user.name),
                                    React.createElement('p', {
                                        className: 'text-gray-600 text-lg'
                                    }, '@' + user.username)
                                ),
                                isOwnProfile && React.createElement('button', {
                                    onClick: () => setShowAddCity(true),
                                    className: 'bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-xl font-semibold hover:opacity-90 transition shadow-md'
                                }, '+ Add City')
                            ),
                            React.createElement('div', {
                                className: 'flex gap-8 mt-6'
                            },
                                React.createElement('div', {
                                    className: 'text-center'
                                },
                                    React.createElement('div', {
                                        className: 'text-2xl font-bold text-gray-900'
                                    }, user.cities.length),
                                    React.createElement('div', {
                                        className: 'text-gray-600 text-sm'
                                    }, 'Cities')
                                ),
                                React.createElement('div', {
                                    className: 'text-center'
                                },
                                    React.createElement('div', {
                                        className: 'text-2xl font-bold text-gray-900'
                                    }, totalPlaces),
                                    React.createElement('div', {
                                        className: 'text-gray-600 text-sm'
                                    }, 'Places')
                                )
                            )
                        )
                    )
                ),
                showAddCity && React.createElement('div', {
                    className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4'
                },
                    React.createElement('div', {
                        className: 'bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl'
                    },
                        React.createElement('h3', {
                            className: 'text-2xl font-bold mb-6'
                        }, 'Add a City'),
                        React.createElement('form', {
                            onSubmit: handleAddCity,
                            className: 'space-y-4'
                        },
                            React.createElement('div', {},
                                React.createElement('label', {
                                    className: 'block text-sm font-medium text-gray-700 mb-2'
                                }, 'City Name'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: cityName,
                                    onChange: (e) => setCityName(e.target.value),
                                    className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500',
                                    placeholder: 'Savannah',
                                    autoFocus: true
                                })
                            ),
                            React.createElement('div', {},
                                React.createElement('label', {
                                    className: 'block text-sm font-medium text-gray-700 mb-2'
                                }, 'Country'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: country,
                                    onChange: (e) => setCountry(e.target.value),
                                    className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500',
                                    placeholder: 'USA'
                                })
                            ),
                            React.createElement('div', {
                                className: 'flex gap-3 mt-6'
                            },
                                React.createElement('button', {
                                    type: 'button',
                                    onClick: () => setShowAddCity(false),
                                    className: 'flex-1 px-4 py-3 border border-gray-300 rounded-xl hover:bg-gray-50 font-medium'
                                }, 'Cancel'),
                                React.createElement('button', {
                                    type: 'submit',
                                    className: 'flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-3 rounded-xl hover:opacity-90 font-semibold shadow-md'
                                }, 'Add City')
                            )
                        )
                    )
                ),
                React.createElement('div', {
                    className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'
                },
                    user.cities.map(city =>
                        React.createElement('div', {
                            key: city.id,
                            onClick: () => onCityClick(city),
                            className: 'bg-white rounded-2xl shadow-sm overflow-hidden cursor-pointer card-hover'
                        },
                            React.createElement('div', {
                                className: 'h-48 bg-gradient-to-br from-purple-400 via-pink-400 to-orange-400 flex items-center justify-center relative'
                            },
                                React.createElement('div', {
                                    className: 'text-white text-center z-10'
                                },
                                    React.createElement('div', {
                                        className: 'text-5xl mb-2'
                                    }, 'ðŸ“'),
                                    React.createElement('div', {
                                        className: 'text-2xl font-bold'
                                    }, city.name),
                                    React.createElement('div', {
                                        className: 'text-sm opacity-90 mt-1'
                                    }, city.country)
                                )
                            ),
                            React.createElement('div', {
                                className: 'p-4'
                            },
                                React.createElement('p', {
                                    className: 'text-gray-600 font-medium'
                                }, city.places.length + ' ' + (city.places.length === 1 ? 'place' : 'places'))
                            )
                        )
                    )
                ),
                user.cities.length === 0 && React.createElement('div', {
                    className: 'text-center py-20'
                },
                    React.createElement('div', {
                        className: 'text-6xl mb-4'
                    }, 'ðŸŒ'),
                    React.createElement('p', {
                        className: 'text-xl text-gray-600 mb-2'
                    }, 'No cities added yet'),
                    isOwnProfile && React.createElement('p', {
                        className: 'text-gray-500'
                    }, 'Click "Add City" to start sharing your travels!')
                )
            );
        };

        const CityView = ({ user, city, isOwnCity, onAddPlace, onBack }) => {
            const [showAddPlace, setShowAddPlace] = useState(false);

            function handleShare() {
                // Create a shareable text summary
                let shareText = `ðŸŒ ${user.name}'s Guide to ${city.name}, ${city.country}\n\n`;
                
                city.places.forEach((place, idx) => {
                    shareText += `${idx + 1}. ${place.name}\n`;
                    shareText += `   ðŸ“ ${place.address}\n`;
                    if (place.notes) {
                        shareText += `   ðŸ’­ ${place.notes}\n`;
                    }
                    shareText += `\n`;
                });
                
                shareText += `\nâœ¨ Created with TravelGram`;
                
                // Try to use native share if available (mobile)
                if (navigator.share) {
                    navigator.share({
                        title: `${user.name}'s ${city.name} Guide`,
                        text: shareText
                    }).catch(err => console.log('Share cancelled'));
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(shareText).then(() => {
                        alert('âœ… Guide copied to clipboard! Paste it in a message to your friend.');
                    }).catch(() => {
                        // Final fallback: show in alert
                        alert(shareText);
                    });
                }
            }

            return React.createElement('div', {
                className: 'max-w-5xl mx-auto px-4 py-8'
            },
                React.createElement('button', {
                    onClick: onBack,
                    className: 'mb-6 flex items-center gap-2 text-gray-600 hover:text-gray-900 font-medium'
                },
                    React.createElement('svg', {
                        className: 'w-5 h-5',
                        fill: 'none',
                        stroke: 'currentColor',
                        viewBox: '0 0 24 24'
                    },
                        React.createElement('path', {
                            strokeLinecap: 'round',
                            strokeLinejoin: 'round',
                            strokeWidth: 2,
                            d: 'M15 19l-7-7 7-7'
                        })
                    ),
                    'Back to ' + user.name + "'s profile"
                ),
                React.createElement('div', {
                    className: 'bg-white rounded-2xl shadow-sm p-8 mb-8'
                },
                    React.createElement('div', {
                        className: 'flex items-center justify-between'
                    },
                        React.createElement('div', {},
                            React.createElement('h2', {
                                className: 'text-3xl font-bold text-gray-900'
                            }, city.name + ', ' + city.country),
                            React.createElement('p', {
                                className: 'text-gray-600 mt-1'
                            }, 'by @' + user.username),
                            React.createElement('p', {
                                className: 'text-gray-500 mt-2'
                            }, city.places.length + ' ' + (city.places.length === 1 ? 'place' : 'places'))
                        ),
                        React.createElement('div', {
                            className: 'flex gap-3'
                        },
                            city.places.length > 0 && React.createElement('button', {
                                onClick: handleShare,
                                className: 'bg-green-500 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-600 shadow-md flex items-center gap-2'
                            }, 
                                React.createElement('svg', {
                                    className: 'w-5 h-5',
                                    fill: 'none',
                                    stroke: 'currentColor',
                                    viewBox: '0 0 24 24'
                                },
                                    React.createElement('path', {
                                        strokeLinecap: 'round',
                                        strokeLinejoin: 'round',
                                        strokeWidth: 2,
                                        d: 'M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z'
                                    })
                                ),
                                'Share'
                            ),
                            isOwnCity && React.createElement('button', {
                                onClick: () => setShowAddPlace(true),
                                className: 'bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-xl font-semibold hover:opacity-90 shadow-md'
                            }, '+ Add Place')
                        )
                    )
                ),
                city.places.length > 0 && React.createElement(MapView, { places: city.places, cityName: city.name }),
                React.createElement('div', {
                    className: 'mt-8 space-y-6'
                },
                    city.places.map(place =>
                        React.createElement(PlaceCard, { key: place.id, place })
                    )
                ),
                city.places.length === 0 && React.createElement('div', {
                    className: 'text-center py-20 bg-white rounded-2xl'
                },
                    React.createElement('div', {
                        className: 'text-6xl mb-4'
                    }, 'ðŸ›ï¸'),
                    React.createElement('p', {
                        className: 'text-xl text-gray-600 mb-2'
                    }, 'No places added yet'),
                    isOwnCity && React.createElement('p', {
                        className: 'text-gray-500'
                    }, 'Click "Add Place" to start building your guide!')
                ),
                showAddPlace && React.createElement(AddPlaceModal, {
                    cityId: city.id,
                    cityName: city.name,
                    onClose: () => setShowAddPlace(false),
                    onAdd: async (place) => {
                        await onAddPlace(city.id, place);
                        setShowAddPlace(false);
                    }
                })
            );
        };

        const AddPlaceModal = ({ cityId, cityName, onClose, onAdd }) => {
            const [placeName, setPlaceName] = useState('');
            const [address, setAddress] = useState('');
            const [notes, setNotes] = useState('');
            const [photos, setPhotos] = useState([]);

            function handlePhotoUpload(e) {
                const files = Array.from(e.target.files);
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setPhotos(prev => [...prev, event.target.result]);
                    };
                    reader.readAsDataURL(file);
                });
            }

            async function handleSubmit(e) {
                e.preventDefault();
                if (!placeName.trim() || !address.trim()) return;
                
                // Auto-add city if not included
                const fullAddress = address.includes(cityName) ? address : address + ', ' + cityName;
                
                await onAdd({
                    name: placeName,
                    address: fullAddress,
                    notes,
                    photos,
                    placeId: null
                });
            }

            return React.createElement('div', {
                className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 overflow-y-auto',
                style: { zIndex: 9999 }
            },
                React.createElement('div', {
                    className: 'bg-white rounded-2xl p-8 max-w-2xl w-full my-8 shadow-2xl',
                    style: { position: 'relative', zIndex: 10000 }
                },
                    React.createElement('h3', {
                        className: 'text-2xl font-bold mb-6'
                    }, 'Add a Place to ' + cityName),
                    React.createElement('form', {
                        onSubmit: handleSubmit,
                        className: 'space-y-5'
                    },
                        React.createElement('div', {
                            className: 'bg-gradient-to-r from-blue-50 to-purple-50 border border-purple-200 rounded-xl p-4 mb-4'
                        },
                            React.createElement('div', {
                                className: 'flex items-start gap-3'
                            },
                                React.createElement('div', {
                                    className: 'text-2xl'
                                }, 'ðŸ’¡'),
                                React.createElement('div', {
                                    className: 'text-sm text-gray-700'
                                },
                                    React.createElement('div', {
                                        className: 'font-semibold mb-1'
                                    }, 'Quick tip: Find addresses instantly'),
                                    React.createElement('div', {}, 'Open Google Maps in another tab, search for the place, and copy the address. Takes 5 seconds!')
                                )
                            )
                        ),
                        React.createElement('div', {},
                            React.createElement('label', {
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'Place Name'),
                            React.createElement('input', {
                                type: 'text',
                                value: placeName,
                                onChange: (e) => setPlaceName(e.target.value),
                                className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 text-lg',
                                placeholder: 'e.g., Sunday Sunday',
                                required: true,
                                autoFocus: true
                            })
                        ),
                        React.createElement('div', {},
                            React.createElement('label', {
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'Street Address'),
                            React.createElement('input', {
                                type: 'text',
                                value: address,
                                onChange: (e) => setAddress(e.target.value),
                                className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 text-lg',
                                placeholder: 'e.g., 123 Bull St (we\'ll add ' + cityName + ')',
                                required: true
                            }),
                            React.createElement('div', {
                                className: 'text-xs text-gray-500 mt-2'
                            }, 'âœ¨ Just the street address - the city name will be added automatically')
                        ),
                        React.createElement('div', {},
                            React.createElement('label', {
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'Your notes (optional)'),
                            React.createElement('textarea', {
                                value: notes,
                                onChange: (e) => setNotes(e.target.value),
                                className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500',
                                rows: 4,
                                placeholder: 'What did you love? Any tips for friends visiting?'
                            })
                        ),
                        React.createElement('div', {},
                            React.createElement('label', {
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'Photos (optional)'),
                            React.createElement('input', {
                                type: 'file',
                                accept: 'image/*',
                                multiple: true,
                                onChange: handlePhotoUpload,
                                className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500'
                            }),
                            photos.length > 0 && React.createElement('div', {
                                className: 'mt-4 grid grid-cols-3 gap-3'
                            },
                                photos.map((photo, idx) =>
                                    React.createElement('div', {
                                        key: idx,
                                        className: 'relative group'
                                    },
                                        React.createElement('img', {
                                            src: photo,
                                            alt: '',
                                            className: 'w-full h-24 object-cover rounded-xl'
                                        }),
                                        React.createElement('button', {
                                            type: 'button',
                                            onClick: () => setPhotos(photos.filter((_, i) => i !== idx)),
                                            className: 'absolute top-2 right-2 bg-red-500 text-white rounded-full w-7 h-7 flex items-center justify-center opacity-0 group-hover:opacity-100 transition'
                                        }, 'Ã—')
                                    )
                                )
                            )
                        ),
                        React.createElement('div', {
                            className: 'flex gap-3 pt-4'
                        },
                            React.createElement('button', {
                                type: 'button',
                                onClick: onClose,
                                className: 'flex-1 px-4 py-3 border border-gray-300 rounded-xl hover:bg-gray-50 font-medium'
                            }, 'Cancel'),
                            React.createElement('button', {
                                type: 'submit',
                                className: 'flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-3 rounded-xl hover:opacity-90 font-semibold shadow-md'
                            }, 'Add Place')
                        )
                    )
                )
            );
        };

        const MapView = ({ places, cityName }) => {
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const markersRef = useRef([]);

            useEffect(() => {
                // Wait for Leaflet to be ready and map container to exist
                if (!mapRef.current || !window.L || places.length === 0) return;

                // Small delay to ensure DOM is ready
                setTimeout(() => {
                    if (!mapRef.current) return;

                    // Initialize map only once
                    if (!mapInstanceRef.current) {
                        try {
                            mapInstanceRef.current = window.L.map(mapRef.current).setView([32.0809, -81.0912], 13);
                            
                            window.L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: 'Â© OpenStreetMap contributors',
                                maxZoom: 19
                            }).addTo(mapInstanceRef.current);
                        } catch (error) {
                            console.error('Map initialization error:', error);
                            return;
                        }
                    }

                    // Clear existing markers
                    markersRef.current.forEach(marker => {
                        try {
                            mapInstanceRef.current.removeLayer(marker);
                        } catch (e) {}
                    });
                    markersRef.current = [];

                    // Add markers for each place
                    const bounds = [];
                    let markersAdded = 0;
                    
                    places.forEach(async (place, idx) => {
                        try {
                            // Use Nominatim (OpenStreetMap's geocoding service)
                            const response = await fetch(
                                `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(place.address)}`,
                                {
                                    headers: {
                                        'User-Agent': 'TravelGram-App'
                                    }
                                }
                            );
                            const data = await response.json();
                            
                            if (data && data.length > 0 && mapInstanceRef.current) {
                                const lat = parseFloat(data[0].lat);
                                const lon = parseFloat(data[0].lon);
                                
                                // Create custom numbered icon
                                const numberIcon = window.L.divIcon({
                                    className: 'custom-marker',
                                    html: `<div style="
                                        background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
                                        color: white;
                                        width: 32px;
                                        height: 32px;
                                        border-radius: 50%;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        font-weight: bold;
                                        font-size: 14px;
                                        border: 3px solid white;
                                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                                    ">${idx + 1}</div>`,
                                    iconSize: [32, 32],
                                    iconAnchor: [16, 16]
                                });
                                
                                const marker = window.L.marker([lat, lon], { icon: numberIcon })
                                    .addTo(mapInstanceRef.current);
                                
                                marker.bindPopup(`
                                    <div style="padding: 8px;">
                                        <strong style="font-size: 16px;">${place.name}</strong><br/>
                                        <span style="color: #666; font-size: 13px;">${place.address}</span>
                                    </div>
                                `);
                                
                                markersRef.current.push(marker);
                                bounds.push([lat, lon]);
                                markersAdded++;
                                
                                // Fit map to show all markers once all are loaded
                                if (markersAdded === places.length && bounds.length > 0) {
                                    mapInstanceRef.current.fitBounds(bounds, { padding: [50, 50] });
                                }
                            }
                        } catch (error) {
                            console.error('Geocoding error:', error);
                        }
                    });
                }, 100);

                return () => {
                    // Cleanup on unmount
                    markersRef.current.forEach(marker => {
                        try {
                            if (mapInstanceRef.current) {
                                mapInstanceRef.current.removeLayer(marker);
                            }
                        } catch (e) {}
                    });
                };
            }, [places, places.length]);

            return React.createElement('div', {
                className: 'bg-white rounded-2xl shadow-sm p-6 mb-8'
            },
                React.createElement('h3', {
                    className: 'text-xl font-bold mb-4 flex items-center gap-2'
                }, 
                    React.createElement('span', {}, 'ðŸ—ºï¸'),
                    'Map of All Places (' + places.length + ')'
                ),
                React.createElement('div', {
                    ref: mapRef,
                    id: 'map-container-' + Date.now(),
                    style: { 
                        height: '400px', 
                        width: '100%', 
                        borderRadius: '12px',
                        backgroundColor: '#e5e7eb'
                    }
                })
            );
        };

        const PlaceCard = ({ place }) => {
            return React.createElement('div', {
                className: 'bg-white rounded-2xl shadow-sm overflow-hidden'
            },
                place.photos && place.photos.length > 0 && React.createElement('div', {
                    className: place.photos.length === 1 ? '' : 'grid grid-cols-3 gap-1'
                },
                    place.photos.slice(0, 3).map((photo, idx) =>
                        React.createElement('img', {
                            key: idx,
                            src: photo,
                            alt: '',
                            className: place.photos.length === 1 ? 'w-full h-96 object-cover' : 'w-full h-64 object-cover'
                        })
                    )
                ),
                React.createElement('div', {
                    className: 'p-6'
                },
                    React.createElement('h3', {
                        className: 'text-2xl font-bold text-gray-900 mb-2'
                    }, place.name),
                    React.createElement('p', {
                        className: 'text-gray-600 mb-4 flex items-center gap-2'
                    },
                        React.createElement('svg', {
                            className: 'w-5 h-5',
                            fill: 'none',
                            stroke: 'currentColor',
                            viewBox: '0 0 24 24'
                        },
                            React.createElement('path', {
                                strokeLinecap: 'round',
                                strokeLinejoin: 'round',
                                strokeWidth: 2,
                                d: 'M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z'
                            }),
                            React.createElement('path', {
                                strokeLinecap: 'round',
                                strokeLinejoin: 'round',
                                strokeWidth: 2,
                                d: 'M15 11a3 3 0 11-6 0 3 3 0 016 0z'
                            })
                        ),
                        place.address
                    ),
                    place.notes && React.createElement('div', {
                        className: 'bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4 border border-purple-100'
                    },
                        React.createElement('p', {
                            className: 'text-gray-700 leading-relaxed'
                        }, place.notes)
                    )
                )
            );
        };

        const ExploreView = ({ users, currentUser, onProfileClick }) => {
            const otherUsers = users.filter(u => u.id !== currentUser?.id);

            return React.createElement('div', {
                className: 'max-w-5xl mx-auto px-4 py-8'
            },
                React.createElement('h2', {
                    className: 'text-3xl font-bold text-gray-900 mb-8'
                }, 'Explore Travel Guides'),
                React.createElement('div', {
                    className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'
                },
                    otherUsers.map(user => {
                        const totalPlaces = user.cities.reduce((sum, city) => sum + city.places.length, 0);
                        return React.createElement('div', {
                            key: user.id,
                            onClick: () => onProfileClick(user),
                            className: 'bg-white rounded-2xl shadow-sm p-6 cursor-pointer card-hover'
                        },
                            React.createElement('div', {
                                className: 'flex items-center mb-4'
                            },
                                React.createElement('div', {
                                    className: 'w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xl font-bold mr-4'
                                }, user.name.charAt(0).toUpperCase()),
                                React.createElement('div', {},
                                    React.createElement('h3', {
                                        className: 'text-xl font-bold text-gray-900'
                                    }, user.name),
                                    React.createElement('p', {
                                        className: 'text-gray-600'
                                    }, '@' + user.username)
                                )
                            ),
                            React.createElement('div', {
                                className: 'space-y-2'
                            },
                                React.createElement('div', {
                                    className: 'flex gap-6'
                                },
                                    React.createElement('div', {},
                                        React.createElement('span', {
                                            className: 'font-bold text-gray-900'
                                        }, user.cities.length),
                                        React.createElement('span', {
                                            className: 'text-gray-600 text-sm ml-1'
                                        }, 'cities')
                                    ),
                                    React.createElement('div', {},
                                        React.createElement('span', {
                                            className: 'font-bold text-gray-900'
                                        }, totalPlaces),
                                        React.createElement('span', {
                                            className: 'text-gray-600 text-sm ml-1'
                                        }, 'places')
                                    )
                                ),
                                user.cities.length > 0 && React.createElement('div', {
                                    className: 'flex flex-wrap gap-2 mt-3'
                                },
                                    user.cities.slice(0, 3).map(city =>
                                        React.createElement('span', {
                                            key: city.id,
                                            className: 'bg-gradient-to-r from-purple-100 to-pink-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium'
                                        }, city.name)
                                    ),
                                    user.cities.length > 3 && React.createElement('span', {
                                        className: 'text-gray-500 text-sm py-1'
                                    }, '+' + (user.cities.length - 3) + ' more')
                                )
                            )
                        );
                    })
                ),
                otherUsers.length === 0 && React.createElement('div', {
                    className: 'text-center py-20 bg-white rounded-2xl'
                },
                    React.createElement('div', {
                        className: 'text-6xl mb-4'
                    }, 'ðŸŒŽ'),
                    React.createElement('p', {
                        className: 'text-xl text-gray-600 mb-2'
                    }, 'No other travelers yet'),
                    React.createElement('p', {
                        className: 'text-gray-500'
                    }, 'Be the first to share your adventures!')
                )
            );
        };

        const root = createRoot(document.getElementById('app'));
        root.render(React.createElement(App));
    </script>
</body>
</html>